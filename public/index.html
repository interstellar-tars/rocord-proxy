<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="environment" content="dev"/>
<title>Roblox → Discord Webhook Proxy</title>
<style>
  :root {
    --bg: #23262b;
    --panel: #2b2f36;
    --ink: #e7e9ed;
    --muted: #b8bec9;
    --accent: #3ea6ff;
    --accent-2: #2c89d6;
  }

  * {
    box-sizing: border-box
  }

  body {
    margin: 0;
    background: var(--bg);
    color: var(--ink);
    font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif
  }

  header {
    display: flex;
    align-items: center;
    gap: .75rem;
    padding: 14px 18px;
    background: #1c2025;
    box-shadow: 0 2px 10px rgba(0, 0, 0, .25);
    position: sticky;
    top: 0;
    z-index: 2;
  }

  header img {
    height: 36px;
    width: auto;
  }

  header .title {
    font-weight: 700;
    font-size: 18px;
  }

  main {
    max-width: 960px;
    margin: 0 auto;
    padding: 24px;
    display: grid;
    gap: 18px
  }

  .card {
    background: var(--panel);
    border-radius: 16px;
    padding: 18px 18px 20px;
    box-shadow: 0 6px 24px rgba(0, 0, 0, .22);
  }

  h1 {
    margin: 0 0 6px 0;
    font-size: 22px
  }

  .muted {
    color: var(--muted);
    margin-top: 0
  }

  label {
    display: block;
    font-weight: 600;
    margin-top: 10px
  }

  input,
  textarea,
  button {
    font: inherit
  }

  input,
  textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #3a3f47;
    background: #20242a;
    color: var(--ink)
  }

  button {
    padding: 10px 14px;
    border: 0;
    border-radius: 10px;
    background: var(--accent);
    color: #0b1220;
    font-weight: 700;
    cursor: pointer
  }

  button:hover {
    background: var(--accent-2)
  }

  .row {
    display: grid;
    gap: 12px;
    grid-template-columns: 1fr auto
  }

  .code {
    background: #1d2127;
    border: 1px dashed #39414b;
    border-radius: 12px;
    padding: 12px;
    white-space: pre-wrap;
    word-break: break-word
  }

  .small {
    font-size: 12px;
    color: var(--muted)
  }

  .copy {
    margin-left: 8px
  }
</style>
</head>
<body>
<header>
  <img src="/public/logo.png" alt="Logo" onerror="this.style.opacity=0"/>
  <div class="title">Roblox → Discord Webhook Proxy</div>
</header>
<main>
  <section class="card">
    <h1>Proxy your Discord Webhook</h1>
    <p class="muted">Paste a Discord Webhook URL. We’ll generate a proxy endpoint that works with Roblox <code>HttpService</code>. <strong>Self-serve can be disabled in production.</strong></p>
    <div>
      <label>Discord Webhook URL</label>
      <input id="wh" placeholder="https://discord.com/api/webhooks/..." autocomplete="off"/>
    </div>
    <div class="row" style="margin-top:12px">
      <button id="gen">Generate proxy key</button>
      <button id="copy" class="copy" style="display:none">Copy</button>
    </div>
    <div id="out" class="code" style="margin-top:12px;display:none"></div>
  </section>

  <section class="card">
    <h1>Roblox example</h1>
    <p class="muted">Use this snippet to send via the proxy:</p>
    <div class="code" id="snippet"></div>
  </section>
</main>
<script>
const $ = s => document.querySelector(s);
const origin = location.origin;
const SNIPPET = (key)=>`local HttpService = game:GetService("HttpService")
local SEND_URL = "${origin}/api/send/${key || 'KEY'}"

local payload = { content = "Hello from Roblox!" }

local ok, res = pcall(function()
  return HttpService:PostAsync(
    SEND_URL,
    HttpService:JSONEncode(payload),
    Enum.HttpContentType.ApplicationJson
  )
end)

if ok then print("Sent:", res) else warn("Failed:", res) end`;

$("#snippet").textContent = SNIPPET();

function showOut(t){ const out=$("#out"); out.textContent=t; out.style.display='block'; $("#copy").style.display='inline-block'; }
$("#copy").addEventListener("click", async ()=>{
  const txt=$("#out").textContent; try { await navigator.clipboard.writeText(txt); $("#copy").textContent="Copied!"; setTimeout(()=>$("#copy").textContent="Copy", 1200);} catch{};
});
$("#gen").addEventListener("click", async ()=>{
  const wh = $("#wh").value.trim();
  if (!/^https:\/\/(discord(app)?\.com)\/api\/webhooks\//.test(wh)) return showOut("❌ Invalid Discord webhook URL");
  const res = await fetch("/api/selfserve", { method:"POST", headers:{ "content-type":"application/json" }, body: JSON.stringify({ webhook_url: wh }) });
  const data = await res.json().catch(()=>({}));
  if (!res.ok) return showOut("Error: " + (data.error || res.status));
  const send = new URL(data.send_url, origin).toString();
  showOut("✅ Key created\\nSend URL: "+send);
  $("#snippet").textContent = SNIPPET(data.key || 'KEY');
});
document.addEventListener("DOMContentLoaded", () => {
  const envMeta = document.querySelector("meta[name='environment']");
  const env = envMeta ? envMeta.content.toLowerCase() : "production";

  const selfServeNote = document.getElementById("self-serve-note");

  if (env === "production") {
    if (selfServeNote) selfServeNote.remove();
  } else if (env === "dev" || env === "staging") {
    // Keep self-serve note
    const warning = document.createElement("div");
    warning.style.background = "#ffcc00";
    warning.style.color = "#000";
    warning.style.padding = "10px";
    warning.style.textAlign = "center";
    warning.style.fontWeight = "bold";
    warning.textContent =
      "⚠ Warning: You are currently viewing the dev/staging version of this page, it may not work as expected.";
    document.body.prepend(warning);
  }
});

</script>
</body>
</html>
